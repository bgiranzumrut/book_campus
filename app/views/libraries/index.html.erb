<h1>Libraries</h1>

<div id="map" style="height: 500px; width: 100%;"></div>

<% @libraries.each do |library| %>
<div class="card">
  <h2><%= library.name %></h2>
  <p><strong>Address:</strong> <%= library.address %></p>
  <p><strong>WiFi:</strong> <%= library.wifi ? "Available" : "Not Available" %></p>
  <p><strong>Accessibility:</strong> <%= library.accessibility ? "Yes" : "No" %></p>
  <p><strong>Parking:</strong> <%= library.parking_lot ? "Available" : "Not Available" %> (<%= library.parking_stalls %> stalls)</p>
  <% if library.website.present? %>
  <p><%= link_to "Website", library.website, target: "_blank" %></p>
  <% end %>
</div>
<% end %>

<script>
  function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      center: {
        lat: 49.8951,
        lng: -97.1384
      } // Winnipeg default center
    });

    // Fix ERB JSON output
    var libraries = <%= raw @libraries.to_json(only: [:name, :latitude, :longitude]) %>;




    console.log("Loaded Libraries: ", libraries); // Debugging

    libraries.forEach(function(library) {
      if (library.latitude && library.longitude) {
        new google.maps.Marker({
          position: {
            lat: parseFloat(library.latitude),
            lng: parseFloat(library.longitude)
          },
          map: map,
          title: library.name
        });
      }
    });
  }
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBUEt28G5v2kmHS1PuQI1xZAVcWe1jyNf4&callback=initMap"></script>